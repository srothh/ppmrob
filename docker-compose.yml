version: "3"
volumes: 
  workspace:
services:
  ros_master:
    image: ros:noetic-ros-base
    command: roscore
    stdin_open: true
    tty: true
    networks:
      - ppmrob
  publisher:
    build: ./publisher
    environment:
      - "ROS_MASTER_URI=http://ros_master:11311"
      - "ROS_LOG_LEVEL=info"
      - "PYTHONUNBUFFERED=1"
    ports:
      - "9000:9000"
    volumes:
      - workspace:/catkin_ws/src
    networks:
      - ppmrob
    depends_on:
      - ros_master
  listener:
    environment:
      - "ROS_MASTER_URI=http://ros_master:11311"
      - "ROS_LOG_LEVEL=info"
      - "PYTHONUNBUFFERED=1"
    build: ./listener
    ports:
      - "9001:9001"
    networks:
      - ppmrob
    depends_on:
      - ros_master
  drone:
    build: ./drone
    entrypoint: /root/src/entrypoint.sh
    environment:
      - "ROS_MASTER_URI=http://ros_master:11311"
      - "ROS_LOG_LEVEL=debug"
      - "PYTHONUNBUFFERED=1"
    ports:
      - "9003:9003"
      - "8889:8889/udp"
      - "8890:8890/udp"
      - "11111:11111/udp"
    networks:
      - ppmrob
    volumes:
      - workspace:/catkin_ws/src
      - .:/root/src
    depends_on:
      - ros_master
  safety:
    build: ./safety
    entrypoint: /root/src/entrypoint.sh
    environment:
      - "ROS_MASTER_URI=http://ros_master:11311"
      - "ROS_LOG_LEVEL=debug"
      - "PYTHONUNBUFFERED=1"
    ports:
      - "9004:9004"
    networks:
      - ppmrob
    volumes:
      - workspace:/catkin_ws/src
      - .:/root/src
    depends_on:
      - ros_master
networks:
  ppmrob:
    driver: "bridge"
